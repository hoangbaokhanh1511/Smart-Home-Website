Index: templates/login.html
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n  <meta charset=\"UTF-8\">\r\n  <meta name=\"viewport\" content=\"width=1, initial-scale=1.0\">\r\n\r\n  <title>Login Site</title>\r\n\r\n\r\n</head>\r\n<body>\r\n  <h1>This is login page</h1>\r\n  {% with messages = get_flashed_messages(with_categories=true) %}\r\n    {% if messages %}\r\n\r\n      {% for category, message in messages %}\r\n        <p class=\"category\">{{message}}</p>\r\n      {% endfor %}\r\n\r\n    {% endif %}\r\n  {% endwith %}\r\n  <form method=\"post\">\r\n    <caption>Thông tin đăng nhập</caption>\r\n    <p>Username: <input placeholder=\"Enter your username\" type=\"text\" name=\"username\"></p>\r\n    <p>Password: <input placeholder=\"Enter your password\" type=\"password\" name=\"password\"></p>\r\n    <input name=\"handle\" type=\"submit\" value=\"Login\">\r\n    <input name=\"handle\" type=\"submit\" value=\"Signup\">\r\n  </form>\r\n\r\n</body>\r\n\r\n</html>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/templates/login.html b/templates/login.html
--- a/templates/login.html	
+++ b/templates/login.html	
@@ -1,32 +1,72 @@
 <!DOCTYPE html>
 <html lang="en">
+
 <head>
   <meta charset="UTF-8">
-  <meta name="viewport" content="width=1, initial-scale=1.0">
+  <meta name="viewport" content="width=device-width, initial-scale=1.0">
 
   <title>Login Site</title>
 
+  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
+    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
+  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
+    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
+    crossorigin="anonymous"></script>
+  <style>
+    body {
+      height: 100vh;
+      background: linear-gradient(to bottom, rgb(131, 131, 222), white);
+    }
+    .centered-container {
+      display: flex;
+      justify-content: center;
+      align-items: center;
+      height: 100vh;
 
+    }
+    .container{
+      max-width: 400px;
+    }
+  </style>
 </head>
+
 <body>
-  <h1>This is login page</h1>
-  {% with messages = get_flashed_messages(with_categories=true) %}
-    {% if messages %}
-
-      {% for category, message in messages %}
-        <p class="category">{{message}}</p>
-      {% endfor %}
-
-    {% endif %}
-  {% endwith %}
-  <form method="post">
-    <caption>Thông tin đăng nhập</caption>
-    <p>Username: <input placeholder="Enter your username" type="text" name="username"></p>
-    <p>Password: <input placeholder="Enter your password" type="password" name="password"></p>
-    <input name="handle" type="submit" value="Login">
-    <input name="handle" type="submit" value="Signup">
-  </form>
-
+  <div class="centered-container">
+    <div class="container bg-white p-5 border border-1 border-dark rounded-3">
+      <div class="row">
+        <img src="/static/images/Logo.png" alt="Logo">
+      </div>
+      <div class="row">
+        {% with messages = get_flashed_messages(with_categories=true) %}
+        {% if messages %}
+        {% for category, message in messages %}
+        <div class="alert alert-{{ category }}" role="alert">{{ message }}</div>
+        {% endfor %}
+        {% endif %}
+        {% endwith %}
+      </div>
+      <form method="post">
+        <div class="row mb-3">
+          <div class="col-sm-12">
+            <label for="username">Username</label>
+            <input class="form-control" placeholder="Enter your username" type="text" name="username">
+          </div>
+        </div>
+        <div class="row mb-3">
+          <div class="col-sm-12">
+            <label for="password">Password</label>
+            <input class="form-control" placeholder="Enter your password" type="password" name="password">
+          </div>
+        </div>
+        <div class="row">
+          <div class="col-sm-6 d-inline-flex gap-2">
+            <input class="btn btn-success" name="handle" type="submit" value="Login">
+            <input class="btn btn-primary" name="handle" type="submit" value="Signup">
+          </div>
+        </div>
+      </form>
+    </div>
+  </div>
 </body>
 
-</html>
\ No newline at end of file
+</html>
Index: main.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>import dht, ujson, uasyncio as asyncio, urequests,machine,utime\r\nfrom machine import I2C, Pin\r\nfrom esp8266_i2c_lcd import I2cLcd\r\nfrom OOP import *\r\n\r\n# Khai Báo Đèn\r\nled = {\r\n    \"Led_Main\": LED(pin_number=2),\r\n    \"Led_D7\": LED(pin_number=13),\r\n    \"Led_D8\": LED(pin_number=15)\r\n}\r\n\r\nurl_host = 'http://192.168.1.5:5000'\r\n# Pir sensor pir HC-SR501\r\npir = motion_detect(pin_number=14)\r\n\r\n# sensor DHT11\r\nsensor = sensor_dht11(pin_number=16)\r\n\r\n#API thời tiết local\r\n# API_key = \"07bb5510d2576951d78b0f0b637f4716\"\r\n# ion = 107.5796\r\n# iat = 16.4637\r\n# data = (urequests.get(f\"https://api.openweathermap.org/data/2.5/weather?lat={iat}&lon={ion}&appid={API_key}\")).json()\r\n\r\n\r\ndef weather():\r\n    temperature, humidity = sensor.get_weather()\r\n\r\n    data = {\r\n        'temperature': temperature,\r\n        'humidity': humidity\r\n    }\r\n\r\n    return data\r\n\r\nasync def API_weather():\r\n    url = url_host + '/user_dashboard/api/weather'\r\n\r\n    while True:\r\n\r\n        API_key = \"07bb5510d2576951d78b0f0b637f4716\"\r\n        ion = 107.5796\r\n        iat = 16.4637\r\n        data = (urequests.get(f\"https://api.openweathermap.org/data/2.5/weather?lat={iat}&lon={ion}&appid={API_key}\")).json()\r\n\r\n        up_data = {\r\n            'temperature': data['main']['temp'] - 273,\r\n            'humidity': data['main']['humidity'],\r\n            'feels_like': data['main']['feels_like'] - 273,\r\n            'main': data['weather'][0]['main'],\r\n            'visibility': data['visibility']\r\n        }\r\n\r\n        respone = urequests.post(url,data=ujson.dumps(up_data),headers={'Content-type':'application/json'})\r\n        respone.close()\r\n\r\n        await asyncio.sleep(900)\r\n\r\nasync def send_pir():\r\n    url = url_host + '/user_dashboard/api/motion'\r\n    while True:\r\n        data = {'status': True if pir.get_status() else False}\r\n        headers = {'Content-Type': 'application/json'}\r\n        try:\r\n            response = urequests.post(url, data=ujson.dumps(data), headers=headers)\r\n\r\n            response.close()\r\n        except OSError as e:\r\n            print('Error loading LED:', e)\r\n\r\n        await asyncio.sleep(10)\r\n\r\n\r\nasync def toggleLed():\r\n    url = url_host + '/user_dashboard/api/change_status_led'\r\n    while True:\r\n        response = urequests.get(url)\r\n\r\n        data = response.json()\r\n        # print(data)\r\n        if data['Led_Main']:\r\n            led.get('Led_Main').turn_off()\r\n        else:\r\n            led.get('Led_Main').turn_on()\r\n\r\n        if data['Led_D7']:\r\n            led.get('Led_D7').turn_on()\r\n        else:\r\n            led.get('Led_D7').turn_off()\r\n\r\n        if data['Led_D8']:\r\n            led.get('Led_D8').turn_on()\r\n        else:\r\n            led.get('Led_D8').turn_off()\r\n\r\n        response.close()\r\n        await asyncio.sleep(0.2)\r\n\r\n\r\n# adc = ADC(0)\r\n# async def MQT135():\r\n#\r\n#     while True:\r\n#         adc_value = adc.read()\r\n#         co2_concentration = adc_value * 2.5\r\n#         nh3_concentration = adc_value * 1.8\r\n#         co_concentration = adc_value * 1.3\r\n#         ethanol_concentration = adc_value * 1.5\r\n#\r\n#         print(f\"Nồng độ co2 {co2_concentration} đơn vị ppm\")\r\n#         print(f\"Nồng độ nh3 {nh3_concentration} đơn vị ppm\")\r\n#         print(f\"Nồng độ co {co_concentration} đơn vị ppm\")\r\n#         print(f\"Nồng độ ethanol {ethanol_concentration} đơn vị ppm\")\r\n#         await asyncio.sleep(1)\r\n\r\n\r\nasync def LCD():\r\n\r\n    data = weather()\r\n    DEFAULT_I2C_ADDR = 0x27\r\n    i2c = I2C(scl=Pin(5), sda=Pin(4), freq=400000)\r\n    lcd = I2cLcd(i2c, DEFAULT_I2C_ADDR, 2, 16)\r\n    celcius = bytearray([\r\n        0x0E,\r\n        0x11,\r\n        0x11,\r\n        0x0E,\r\n        0x00,\r\n        0x00,\r\n        0x00,\r\n        0x00\r\n    ])\r\n    lcd.custom_char(0, celcius)\r\n    lcd.putstr(f\"Nhiet Do: {data.get('temperature')}\")\r\n    lcd.putchar(chr(0))\r\n    lcd.putstr(f\"C\\nDo am: {data.get('humidity')}%\")\r\n\r\n\r\nasync def main():\r\n\r\n    await asyncio.gather(\r\n        LCD(),\r\n        API_weather(),\r\n        send_pir(),\r\n        toggleLed()\r\n    )\r\n    print(\"Done\")\r\n\r\nloop = asyncio.get_event_loop()\r\nloop.run_until_complete(main())\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/main.py b/main.py
--- a/main.py	
+++ b/main.py	
@@ -1,62 +1,33 @@
-import dht, ujson, uasyncio as asyncio, urequests,machine,utime
-from machine import I2C, Pin
+import dht, ujson, uasyncio as asyncio, urequests
+from machine import I2C
 from esp8266_i2c_lcd import I2cLcd
 from OOP import *
-
-# Khai Báo Đèn
+from MQ135 import MQ135
+# Khai Báo Đèn Bật Tắt và điều chỉnh độ sáng của đèn
 led = {
     "Led_Main": LED(pin_number=2),
     "Led_D7": LED(pin_number=13),
     "Led_D8": LED(pin_number=15)
 }
 
-url_host = 'http://192.168.1.5:5000'
+url_host = 'http://192.168.1.8:5000'
 # Pir sensor pir HC-SR501
 pir = motion_detect(pin_number=14)
 
 # sensor DHT11
 sensor = sensor_dht11(pin_number=16)
 
-#API thời tiết local
-# API_key = "07bb5510d2576951d78b0f0b637f4716"
-# ion = 107.5796
-# iat = 16.4637
-# data = (urequests.get(f"https://api.openweathermap.org/data/2.5/weather?lat={iat}&lon={ion}&appid={API_key}")).json()
-
+# MQT135
+adc = MQ135(0)
 
 def weather():
     temperature, humidity = sensor.get_weather()
-
     data = {
         'temperature': temperature,
         'humidity': humidity
     }
-
     return data
 
-async def API_weather():
-    url = url_host + '/user_dashboard/api/weather'
-
-    while True:
-
-        API_key = "07bb5510d2576951d78b0f0b637f4716"
-        ion = 107.5796
-        iat = 16.4637
-        data = (urequests.get(f"https://api.openweathermap.org/data/2.5/weather?lat={iat}&lon={ion}&appid={API_key}")).json()
-
-        up_data = {
-            'temperature': data['main']['temp'] - 273,
-            'humidity': data['main']['humidity'],
-            'feels_like': data['main']['feels_like'] - 273,
-            'main': data['weather'][0]['main'],
-            'visibility': data['visibility']
-        }
-
-        respone = urequests.post(url,data=ujson.dumps(up_data),headers={'Content-type':'application/json'})
-        respone.close()
-
-        await asyncio.sleep(900)
-
 async def send_pir():
     url = url_host + '/user_dashboard/api/motion'
     while True:
@@ -69,54 +40,37 @@
         except OSError as e:
             print('Error loading LED:', e)
 
-        await asyncio.sleep(10)
+        await asyncio.sleep(5)
 
 
 async def toggleLed():
     url = url_host + '/user_dashboard/api/change_status_led'
     while True:
         response = urequests.get(url)
-
         data = response.json()
-        # print(data)
-        if data['Led_Main']:
-            led.get('Led_Main').turn_off()
-        else:
-            led.get('Led_Main').turn_on()
 
-        if data['Led_D7']:
-            led.get('Led_D7').turn_on()
-        else:
-            led.get('Led_D7').turn_off()
-
-        if data['Led_D8']:
-            led.get('Led_D8').turn_on()
-        else:
-            led.get('Led_D8').turn_off()
+        led['Led_Main'].toggle(data['Led_Main'])
+        led['Led_D7'].toggle(data['Led_D7'])
+        led['Led_D8'].toggle(data['Led_D8'])
 
         response.close()
-        await asyncio.sleep(0.2)
+        await asyncio.sleep(0.1)
 
 
-# adc = ADC(0)
-# async def MQT135():
-#
-#     while True:
-#         adc_value = adc.read()
-#         co2_concentration = adc_value * 2.5
-#         nh3_concentration = adc_value * 1.8
-#         co_concentration = adc_value * 1.3
-#         ethanol_concentration = adc_value * 1.5
-#
-#         print(f"Nồng độ co2 {co2_concentration} đơn vị ppm")
-#         print(f"Nồng độ nh3 {nh3_concentration} đơn vị ppm")
-#         print(f"Nồng độ co {co_concentration} đơn vị ppm")
-#         print(f"Nồng độ ethanol {ethanol_concentration} đơn vị ppm")
-#         await asyncio.sleep(1)
+async def MQT135():
+    url = url_host + '/user_dashboard/api/mqt135'
+    while True:
+        data = weather()
+        value = adc.get_corrected_ppm(data['temperature'],data['humidity'])
+        mqt = {
+            'value': value
+        }
+        response = urequests.post(url=url, headers={'Content-Type': 'application/json'}, data=ujson.dumps(mqt))
+        response.close()
+        await asyncio.sleep(3)
 
 
 async def LCD():
-
     data = weather()
     DEFAULT_I2C_ADDR = 0x27
     i2c = I2C(scl=Pin(5), sda=Pin(4), freq=400000)
@@ -135,17 +89,31 @@
     lcd.putstr(f"Nhiet Do: {data.get('temperature')}")
     lcd.putchar(chr(0))
     lcd.putstr(f"C\nDo am: {data.get('humidity')}%")
+    await asyncio.sleep(2)
+
 
+async def dht11():
+    url = url_host + '/user_dashboard/api/weather'
+    while True:
+        data = weather()
+        up_data = {
+            'temperature': data.get('temperature'),
+            'humidity': data.get('humidity')
+        }
+        response = urequests.post(data=ujson.dumps(up_data),headers={"Content-Type": "application/json"},url=url)
+        response.close()
+
+        await asyncio.sleep(5)
 
 async def main():
-
     await asyncio.gather(
+        MQT135(),
+        dht11(),
         LCD(),
-        API_weather(),
         send_pir(),
-        toggleLed()
+        toggleLed(),
     )
-    print("Done")
+
 
 loop = asyncio.get_event_loop()
 loop.run_until_complete(main())
Index: static/styles/style.css
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>body{\r\n  font-family: Verdana, Geneva, Tahoma, sans-serif;\r\n  padding: 50px;\r\n  background-color: #537AA8;\r\n  display: flex;\r\n  row-gap: 5px;\r\n  flex-direction: row;\r\n\r\n  justify-content: center;\r\n  align-items: stretch;\r\n}\r\ndiv{\r\n  margin: 0px;\r\n  padding: 0px;\r\n}\r\n.main-left{\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: space-between;\r\n  height: 60vh;\r\n}\r\n.main-right{\r\n  display: flex;\r\n  flex-direction: column;\r\n  margin: 0px;\r\n  border-radius: 2%;\r\n\r\n}\r\n.tittle{\r\n  font-size: 36px;\r\n  font-weight: bold;\r\n  display: flex;\r\n  justify-content: center;\r\n  color: #2554AF;\r\n  text-shadow: #537AA8 2px 2px 5px;\r\n}\r\n.button-section{\r\n  display: flex;\r\n  flex-direction: column;\r\n  row-gap: 20px;\r\n  padding-left: 20px;\r\n  padding-right: 20px;\r\n}\r\nbutton{\r\n  width: 40px;\r\n  background-color: #c1e0ff;\r\n  border-radius:15px;\r\n  border: none;\r\n}\r\n\r\n.adiv {\r\n  background-color: #94BDED;\r\n  padding: 30px;\r\n  box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.5);\r\n  margin: 10px;\r\n  border-radius: 10px;\r\n  height: 57.5vh;\r\n\r\n}\r\n/* ============ DEMO ESP8266 ============================= */\r\n.container{\r\n\r\n  display: flex;\r\n  flex-direction: column;\r\n  padding: 25px;\r\n  row-gap: 20px;\r\n}\r\n.led_main,.ledD0,.ledD1,.Traffic{\r\n\r\n  height: 20%;\r\n  display: flex;\r\n  flex-direction: row;\r\n  justify-content: space-around;\r\n  column-gap: 10px;\r\n  margin: 10px;\r\n}\r\n.led-button,.ledD0-button,.ledD1-button,.led-traffic-button{\r\n  display: flex;\r\n  flex-direction: row;\r\n  column-gap: 10px;\r\n  justify-content: space-between;\r\n}\r\n\r\n/*  ============DỰ BÁO THỜI TIẾT ==================================== */\r\n.weather-forecast{\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: flex-start;\r\n  padding: 25px;\r\n  row-gap: 15px;\r\n  height: 100%;\r\n}\r\n.Tittle{\r\n  font-size: 20px;\r\n  font-weight: bold;\r\n  display: flex;\r\n  justify-content: center;\r\n}\r\n\r\n.nhiet_do,.do_am,.thoi_tiet_chinh,.cam_nhan,.luong_mua_trong_1h_qua,.tam_nhin{\r\n  font-size: 14px;\r\n  font-weight: bold;\r\n}\r\n\r\n\r\nbutton:hover{\r\n  box-shadow: 2px 2px 5px #373a41;\r\n}\r\n#user{\r\n  display: flex;\r\n  align-items:center;\r\n  justify-content: center;\r\n}\r\n#user p{\r\n  font-size: 11px;\r\n  margin: 0;\r\n  padding-right: 4px;\r\n\r\n}\r\n#user input{\r\n  font-size: 11px;\r\n}\r\n\r\n#clock{\r\n  font-size: 12px;\r\n}\r\n#infor{\r\n  overflow: auto;\r\n}\r\n#search_date_bar{\r\n  display: flex;\r\n}\r\n\r\ntable{\r\n  border-collapse: collapse; /*Gộp đường viền*/\r\n}\r\n\r\nth,tr{\r\n  padding: 10px 40px;\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/static/styles/style.css b/static/styles/style.css
--- a/static/styles/style.css	
+++ b/static/styles/style.css	
@@ -5,7 +5,6 @@
   display: flex;
   row-gap: 5px;
   flex-direction: row;
-
   justify-content: center;
   align-items: stretch;
 }
@@ -17,7 +16,7 @@
   display: flex;
   flex-direction: column;
   justify-content: space-between;
-  height: 60vh;
+  /* height: 70vh; */
 }
 .main-right{
   display: flex;
@@ -48,13 +47,25 @@
   border: none;
 }
 
-.adiv {
+.adiv{
   background-color: #94BDED;
   padding: 30px;
   box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.5);
   margin: 10px;
   border-radius: 10px;
-  height: 57.5vh;
+  height: 35vh;
+  display: flex;
+  flex-direction: column;
+  align-items: center;
+
+}
+.bdiv {
+  background-color: #94BDED;
+  padding: 30px;
+  box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.5);
+  margin: 10px;
+  border-radius: 10px;
+
 
 }
 /* ============ DEMO ESP8266 ============================= */
@@ -64,6 +75,7 @@
   flex-direction: column;
   padding: 25px;
   row-gap: 20px;
+  height: fit-content;
 }
 .led_main,.ledD0,.ledD1,.Traffic{
 
@@ -74,7 +86,7 @@
   column-gap: 10px;
   margin: 10px;
 }
-.led-button,.ledD0-button,.ledD1-button,.led-traffic-button{
+.led-button,.ledD0-button,.ledD1-button{
   display: flex;
   flex-direction: row;
   column-gap: 10px;
@@ -85,10 +97,9 @@
 .weather-forecast{
   display: flex;
   flex-direction: column;
-  justify-content: flex-start;
-  padding: 25px;
-  row-gap: 15px;
   height: 100%;
+  row-gap: 25px;
+  justify-content: center;
 }
 .Tittle{
   font-size: 20px;
@@ -97,7 +108,7 @@
   justify-content: center;
 }
 
-.nhiet_do,.do_am,.thoi_tiet_chinh,.cam_nhan,.luong_mua_trong_1h_qua,.tam_nhin{
+.nhiet_do,.do_am,.mqt,.text{
   font-size: 14px;
   font-weight: bold;
 }
@@ -123,6 +134,7 @@
 
 #clock{
   font-size: 12px;
+  margin-top: 15px;
 }
 #infor{
   overflow: auto;
@@ -137,4 +149,41 @@
 
 th,tr{
   padding: 10px 40px;
+}
+#search_date_bar{
+  margin-bottom: 10px;
+}
+
+#custom_light_Main,#custom_light_D7,#custom_light_D8{
+  display: flex;
+  align-items: center;
+  column-gap: 20px;
+}
+
+#confirm_Main,#confirm_D7,#confirm_D8{
+  height: 30px;
+  width: 30px;
+}
+
+.box1,.box2,.box3 {
+  display: inline-flex;
+  align-items: center;
+  padding: 3px 3px;
+  font-size: 15px;
+  border-radius: 5px;
+  border: 1px solid gray;
+}
+.box1 {
+  background-color: rgb(123, 240, 123);
+}
+.box2 {
+  background-color: rgb(204, 204, 5);
+}
+.box3 {
+  background-color: rgb(249, 53, 53);
+}
+
+.row {
+  display: flex;
+  align-items: center;
 }
\ No newline at end of file
Index: app.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>from flask import Flask, render_template, send_file, url_for, jsonify, redirect, session, request, flash\r\nfrom flask_sqlalchemy import SQLAlchemy\r\nfrom datetime import datetime, timezone\r\n\r\napp = Flask(__name__)\r\napp.secret_key = \"HelloWorld!!\"\r\n\r\n\"\"\"\r\nMột số câu lệnh query dùng cho database sqlite3 trong web framework flask\r\ndb.session.add() => thêm element vào database\r\ndb.session.add_all() => thêm nhiều element vào database\r\ndb.session.delete() => xóa element khỏi database\r\ndb.session.execute() => thực hiện câu lệnh SQL trực tiếp vd db.session.execute(\"Select * From Users)\r\ndb.session.query() => thực hiện truy vấn trong sql\r\n''.query.filter() => tìm kiếm có điều kiện\r\n''.query.filter(thuộc_tính.like('%target%')) => tìm kiếm tương đối\r\n-> sắp xếp query.order_by(thuộc tính.asc[hoặc desc]()).all() => asc là bé > lớn, desc là lớn > bé  \r\ndb.session.commit() => lưu các thay đổi sau khi truy vấn\r\n\"\"\"\r\n\r\n# Database của users làm database chính\r\napp.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///users.sqlite3'  # Tạo database có tên là users\r\napp.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False  # theo dõi các sửa đổi object và phát tín hiệu\r\n# database của pir HC-SR501\r\napp.config['SQLALCHEMY_BINDS'] = {\r\n    'pir': 'sqlite:///pir.sqlite3'\r\n}\r\n\r\ndb = SQLAlchemy(app)  # Khởi tạo database (cả database chình và phụ)\r\n\r\n\r\nclass users(db.Model):\r\n    _id = db.Column(\"id\", db.Integer, primary_key=True)\r\n    name = db.Column(\"username\", db.String(100))\r\n    password = db.Column(\"password\", db.String(100))\r\n\r\n    def __init__(self, name, password):\r\n        self.name = name\r\n        self.password = password\r\n\r\n\r\nclass History_Pir(db.Model):\r\n    __bind_key__ = 'pir'\r\n    _id = db.Column(\"id\", db.Integer, primary_key=True)\r\n    timestamp = db.Column(\"Timestamp\", db.DateTime,\r\n                          default=None)  # lấy thời gian hiện với với múi giờ tương ứng\r\n\r\n    def __init__(self):\r\n        now = datetime.now()\r\n        self.timestamp = now.replace(microsecond=0)  # bỏ phần microsecond chỉ lấy ngang hh:mm:ss\r\n\r\n\r\n@app.route('/')\r\ndef home():\r\n    return redirect(url_for('login'))\r\n\r\n\r\n@app.route('/login', methods=[\"POST\", \"GET\"])\r\ndef login():\r\n    if request.method == \"POST\":\r\n        handle = request.form['handle']\r\n        if handle == \"Login\":\r\n\r\n            username = request.form['username']  # lấy username vào phiên làm việc\r\n            password = request.form['password']  # lấy password vào phiên làm việc\r\n\r\n            found_user = users.query.filter_by(name=username, password=password).first()\r\n\r\n            if found_user:\r\n\r\n                session['username'] = found_user.name\r\n\r\n                return redirect(url_for('user_dashboard'))\r\n\r\n            else:\r\n                flash(\"Sai tài khoản mật khẩu !\", \"error\")\r\n                return render_template('login.html')\r\n\r\n        else:\r\n            return redirect(url_for('signup'))\r\n\r\n    else:\r\n        if 'username' in session:\r\n            return redirect(url_for('user_dashboard'))\r\n        return render_template('login.html')\r\n\r\n\r\n@app.route('/signup', methods=[\"GET\", \"POST\"])\r\ndef signup():\r\n    if request.method == \"POST\":\r\n\r\n        user = request.form['username']\r\n        pas = request.form['password']\r\n\r\n        found_user = users.query.filter_by(name=user).first()\r\n\r\n        if user and pas:\r\n\r\n            if not found_user:\r\n\r\n                # Thêm thông tin vào database\r\n                new_user = users(user, pas)\r\n                db.session.add(new_user)\r\n                db.session.commit()\r\n\r\n                flash(\"Đăng ký thành công\", \"success\")\r\n                return redirect(url_for('login'))\r\n\r\n            else:\r\n                flash(\"Tài Khoản đã tồn tại\")\r\n\r\n        else:\r\n\r\n            flash(\"Vui lòng nhập đủ thông tin\")\r\n\r\n    return render_template('signup.html')\r\n\r\n\r\nusername = \"\"\r\n\r\n\r\n@app.route('/user_dashboard', methods=[\"GET\", \"POST\"])\r\ndef user_dashboard():\r\n    global username\r\n    if request.method == \"GET\":\r\n\r\n        username = session['username']\r\n        start = 0\r\n        end = 0\r\n\r\n        if History_Pir.query.count() > 0:\r\n            start = History_Pir.query.first().timestamp.date()\r\n            end = History_Pir.query.order_by(History_Pir.timestamp.desc()).first().timestamp.date()\r\n\r\n        if 'username' in session:\r\n            return render_template('userpage.html', username=username, start=start, end=end)\r\n        else:\r\n            flash(\"Bạn cần phải đăng nhập trước\", \"error\")\r\n            return redirect(url_for('login'))\r\n\r\n\r\n    else:\r\n        handle = request.form.get('button')\r\n        if handle == \"Logout\":\r\n            session.pop('username', None)\r\n            flash(\"Đăng xuất thành công\", \"success\")\r\n            return redirect(url_for('login'))\r\n\r\n        elif handle == \"Date\":\r\n\r\n            start = request.form.get('startDate')\r\n            end = request.form.get('endDate')\r\n\r\n            start_date = datetime.strptime(start, '%Y-%m-%d')\r\n            end_date = datetime.strptime(end, '%Y-%m-%d')\r\n\r\n            result = History_Pir.query.filter(History_Pir.timestamp.between(start_date, end_date)).all()\r\n\r\n            return render_template('userpage.html', username=username, result=result, status=\"OFF\")\r\n\r\n        elif handle == \"Overal\":\r\n            return render_template('userpage.html', status=\"ON\", username=username)\r\n\r\n        else:\r\n            username = session['username']\r\n            return redirect(url_for('change'))\r\n\r\n\r\n@app.route('/change', methods=['GET', 'POST'])\r\ndef change():\r\n    found_user = users.query.filter_by(name=session['username']).first()\r\n    if request.method == \"GET\":\r\n        return render_template('change.html', key=found_user.name)\r\n    else:\r\n        oldpass = request.form['oldPassword']\r\n        newpass = request.form['newPassword']\r\n        repeat = request.form['repeatPassword']\r\n        if not oldpass or not newpass or not repeat:\r\n            flash('Vui lòng điền đầy đủ thông tin', 'error')\r\n        else:\r\n            if found_user.password != oldpass:\r\n                flash('Password cũ không đúng', 'error')\r\n            if newpass != repeat:\r\n                flash('Password repeat không trùng', 'error')\r\n            if newpass == oldpass:\r\n                flash('Trùng với password cũ', 'error')\r\n\r\n        if found_user.password == oldpass and newpass == repeat and newpass != oldpass:\r\n            flash('Thay đổi thành công', 'success')\r\n            found_user.password = newpass\r\n            db.session.commit()\r\n        return render_template('change.html', key=found_user.name)\r\n\r\n    # Ở phía qtv\r\n\r\n\r\n@app.route('/view/database', methods=['GET', 'POST'])\r\ndef data():\r\n    if request.method == 'GET':\r\n        query = request.args.get('query')  # lấy dữ liêu từ url\r\n\r\n        if query:\r\n            result = users.query.filter(users.name.like(f\"%{query}%\")).all()  # => tìm kiếm tương đối\r\n        else:\r\n            result = users.query.all()\r\n\r\n        return render_template('view.html', data=result, query=query)\r\n    else:\r\n        handle = request.form['handle']\r\n\r\n        if handle == 'Add':\r\n\r\n            username = request.form['username']\r\n            password = request.form['password']\r\n\r\n            if username and password:\r\n                found_user = users.query.filter_by(name=username).first()\r\n                if found_user:\r\n                    flash(\"Tài khoản đã tồn tại\", \"error\")\r\n                else:\r\n\r\n                    new_user = users(username, password)\r\n                    db.session.add(new_user)\r\n                    db.session.commit()\r\n\r\n                    flash('Tài khoản đã được thêm')\r\n            else:\r\n                flash('Vui lòng nhập đủ thông tin', 'error')\r\n\r\n\r\n        elif handle == 'Remove':\r\n            username = request.form['username']\r\n            found_user = users.query.filter_by(name=username).first()\r\n            if found_user:\r\n                db.session.delete(found_user)\r\n                db.session.commit()\r\n                flash(\"Xóa tài khoản thành công\", 'success')\r\n\r\n                # Tiến hành đánh số lại id\r\n                # enumerate là một hàm trong Python được sử dụng để đánh số\r\n                # các phần tử của một iterable (như list, tuple, hoặc string)\r\n                # và trả về một đối tượng enumerate\r\n                # cú pháp enumerate(iterable, start=0)\r\n\r\n                all_user = users.query.all()\r\n                for index, user in enumerate(all_user, start=1):\r\n                    user._id = index\r\n                db.session.commit()\r\n\r\n            else:\r\n                flash('Không tìm thấy tài khoản', 'error')\r\n\r\n        result = users.query.all()\r\n        return render_template('view.html', data=result)\r\n\r\n\r\n@app.route('/view/history_pir')\r\ndef history_pir():\r\n    start = History_Pir.query.first()\r\n    end = History_Pir.query.order_by(History_Pir.timestamp.desc()).first()\r\n    if start and end:\r\n\r\n        return render_template('pir.html', data=History_Pir.query.all(), startTime=start, endTime=end)\r\n\r\n    else:\r\n\r\n        return render_template('pir.html', data=History_Pir.query.all())\r\n\r\n\r\n# active form\r\n@app.route('/add')\r\ndef add():\r\n    return render_template('add.html')\r\n\r\n\r\n@app.route('/remove')\r\ndef remove():\r\n    return render_template('remove.html')\r\n\r\n\r\n# Phần này xử lý thao tác module => => => => =>\r\ndata_sensor_dht11 = {\r\n    'temperature': None,\r\n    'humidity': None\r\n}\r\n\r\nstatus_pir = {\r\n    'status': None\r\n}\r\n\r\nled = {\r\n    'Led_Main': False,\r\n    'Led_D7': False,\r\n    'Led_D8': False\r\n}\r\n\r\n\r\n# Xử lý dht11\r\n@app.route('/user_dashboard/api/weather', methods=['POST', 'GET'])\r\ndef get_weather():\r\n    if request.method == 'POST':  # nhận dữ liệu từ mạch\r\n        data = request.get_json()  # lấy dữ liệu được truyền thành file json\r\n        data_sensor_dht11.update(data)  # cập nhật dữ liệu\r\n        if data:\r\n\r\n            return jsonify({\"status\": \"success\", \"data_received\": data}), 200\r\n        else:\r\n            return jsonify({\"status\": \"error\", \"message\": \"No data received\"}), 400\r\n\r\n    else:\r\n        return jsonify(data_sensor_dht11)  # Cập nhật api json\r\n\r\n\r\n# xử lý pir sensor HC-SR501\r\n@app.route('/user_dashboard/api/motion', methods=[\"POST\", \"GET\"])\r\ndef receive_data_motion():\r\n    if request.method == 'POST':\r\n        data = request.get_json()\r\n        status_pir.update(data)\r\n\r\n        if data.get('status') == True:\r\n            detected = History_Pir()\r\n            db.session.add(detected)\r\n            db.session.commit()\r\n\r\n        if data:\r\n            return jsonify({\"status\": \"success\", \"data_received\": data}), 200\r\n        else:\r\n            return jsonify({\"status\": \"error\", \"message\": \"No data received\"}), 400\r\n    else:\r\n        return jsonify(status_pir)\r\n\r\n\r\n# Bật/Tắt Đèn\r\n@app.route('/user_dashboard/api/change_status_led', methods=[\"POST\", \"GET\"])\r\ndef change_status_led():\r\n    if request.method == \"POST\":\r\n        data = request.json\r\n        led_name = data.get('led_name')\r\n        new_status = data.get('state')\r\n        if led_name in led:\r\n            led[led_name] = new_status\r\n            print(led)\r\n            return jsonify({led_name: new_status}), 200\r\n        else:\r\n            return jsonify({'error': 'Đèn không tồn tại'}), 404\r\n    else:\r\n        return jsonify(led)\r\n\r\n\r\nif __name__ == '__main__':\r\n    with app.app_context():\r\n        db.create_all()\r\n    app.run(debug=True, host='0.0.0.0')\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app.py b/app.py
--- a/app.py	
+++ b/app.py	
@@ -1,6 +1,7 @@
 from flask import Flask, render_template, send_file, url_for, jsonify, redirect, session, request, flash
 from flask_sqlalchemy import SQLAlchemy
-from datetime import datetime, timezone
+from datetime import datetime, timedelta
+import requests, io, sys, json
 
 app = Flask(__name__)
 app.secret_key = "HelloWorld!!"
@@ -23,7 +24,8 @@
 app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False  # theo dõi các sửa đổi object và phát tín hiệu
 # database của pir HC-SR501
 app.config['SQLALCHEMY_BINDS'] = {
-    'pir': 'sqlite:///pir.sqlite3'
+    'pir': 'sqlite:///pir.sqlite3',
+    'pending': 'sqlite:///pendingUsers.sqlite3'
 }
 
 db = SQLAlchemy(app)  # Khởi tạo database (cả database chình và phụ)
@@ -38,6 +40,9 @@
         self.name = name
         self.password = password
 
+    def __repr__(self):
+        return f"Name: {self.name}, Password: {self.password}"
+
 
 class History_Pir(db.Model):
     __bind_key__ = 'pir'
@@ -49,6 +54,23 @@
         now = datetime.now()
         self.timestamp = now.replace(microsecond=0)  # bỏ phần microsecond chỉ lấy ngang hh:mm:ss
 
+    def __repr__(self):
+        return f"{self.timestamp}"
+
+
+class pendingUsers(db.Model):
+    __bind_key__ = 'pending'
+    id = db.Column('id', db.Integer, primary_key=True)
+    name = db.Column('Username', db.String(100))
+    password = db.Column('Password', db.String(100))
+
+    def __init__(self, name, password):
+        self.name = name
+        self.password = password
+
+    def __repr__(self):
+        return f"Name: {self.name}, Password: {self.password}"
+
 
 @app.route('/')
 def home():
@@ -99,7 +121,7 @@
             if not found_user:
 
                 # Thêm thông tin vào database
-                new_user = users(user, pas)
+                new_user = pendingUsers(user, pas)
                 db.session.add(new_user)
                 db.session.commit()
 
@@ -124,16 +146,46 @@
     global username
     if request.method == "GET":
 
+        print(pendingUsers.query.all())
+
         username = session['username']
         start = 0
         end = 0
+<<<<<<< HEAD
 
         if History_Pir.query.count() > 0:
             start = History_Pir.query.first().timestamp.date()
             end = History_Pir.query.order_by(History_Pir.timestamp.desc()).first().timestamp.date()
+=======
+        if History_Pir.query.count() > 0:
+
+            start = History_Pir.query.first().timestamp.date()
+            end = History_Pir.query.order_by(History_Pir.timestamp.desc()).first().timestamp.date()
+
+            two_days = start + timedelta(days=2)  # Lấy thời gian
+
+            while (end - two_days).days >= 2:
+
+                dell = History_Pir.query.filter(History_Pir.timestamp.between(start, two_days)).all()
+
+                for data in dell:
+                    db.session.delete(data)
+                db.session.commit()
+
+                start = two_days
+                two_days = two_days + timedelta(days=2)
+
+            # Nếu có xóa thì phải cập nhật lại ID
+            all_pir = History_Pir.query.all()
+            for index, data in enumerate(all_pir, start=1):
+                data._id = index
+            db.session.commit()
+>>>>>>> backend
 
         if 'username' in session:
             return render_template('userpage.html', username=username, start=start, end=end)
+
+
         else:
             flash("Bạn cần phải đăng nhập trước", "error")
             return redirect(url_for('login'))
@@ -170,7 +222,7 @@
 def change():
     found_user = users.query.filter_by(name=session['username']).first()
     if request.method == "GET":
-        return render_template('change.html', key=found_user.name)
+        return render_template('change.html')
     else:
         oldpass = request.form['oldPassword']
         newpass = request.form['newPassword']
@@ -204,7 +256,10 @@
         else:
             result = users.query.all()
 
-        return render_template('view.html', data=result, query=query)
+        result2 = pendingUsers.query.all()
+
+        return render_template('view.html', data=result, pending=result2, query=query)
+
     else:
         handle = request.form['handle']
 
@@ -229,6 +284,7 @@
 
 
         elif handle == 'Remove':
+
             username = request.form['username']
             found_user = users.query.filter_by(name=username).first()
             if found_user:
@@ -250,12 +306,62 @@
             else:
                 flash('Không tìm thấy tài khoản', 'error')
 
-        result = users.query.all()
-        return render_template('view.html', data=result)
+        elif handle == 'Save':
+            form_data = request.form.to_dict(flat=False)  # Chuyển dữ liệu ImmutableMultiDict thành Dictionary
+
+            size = users.query.count()  # Đếm số user trong database
+
+            Newpass = form_data.get('newPassword')
+            OldPass = form_data.get('oldPassword')
+            getID = form_data.get('ID')
+
+            for step in range(size):
+
+                if Newpass[step] != OldPass[step]:
+                    user = users.query.filter_by(_id=getID[step]).first()
+                    user.password = Newpass[step]
+
+            db.session.commit()
+
+        elif handle == "Submit Change":
+
+            data = request.form.to_dict(flat=False)
+
+            user = data.get('user')
+            if user == None:
+                pass
+
+            else:
+                for index in user:
+                    Id, status = index.split(' ')
+                    Id = int(Id)
+
+                    clone_user = pendingUsers.query.filter_by(id=Id).first()
+                    if status == 'True':
+                        newUser = users(clone_user.name, clone_user.password)
+
+                        db.session.add(newUser)
+
+                    db.session.delete(clone_user)
+
+                all_user = pendingUsers.query.all()
+                for index, user in enumerate(all_user, start=1):
+                    user.id = index
+
+                db.session.commit()
+
+        result1 = users.query.all()
+        result2 = pendingUsers.query.all()
+
+        return render_template('view.html', data=result1, pending=result2)
 
 
 @app.route('/view/history_pir')
 def history_pir():
+    if username == "":
+        flash('Bạn phải đăng nhập trước')
+        return redirect(url_for('login'))
+
     start = History_Pir.query.first()
     end = History_Pir.query.order_by(History_Pir.timestamp.desc()).first()
     if start and end:
@@ -267,15 +373,10 @@
         return render_template('pir.html', data=History_Pir.query.all())
 
 
-# active form
-@app.route('/add')
-def add():
-    return render_template('add.html')
-
-
-@app.route('/remove')
-def remove():
-    return render_template('remove.html')
+@app.route('/view/weather')
+def five_days_weather():
+    result = get_weather_for_five_days()
+    return render_template('weather.html', result=result)
 
 
 # Phần này xử lý thao tác module => => => => =>
@@ -289,10 +390,28 @@
 }
 
 led = {
-    'Led_Main': False,
-    'Led_D7': False,
-    'Led_D8': False
+    'Led_Main': 1023,
+    'Led_D7': 0,
+    'Led_D8': 0
 }
+
+mqt135 = {
+    'value': 0
+}
+
+
+# Xử lý mqt135
+@app.route('/user_dashboard/api/mqt135', methods=['POST', 'GET'])
+def get_mqt135():
+    if request.method == 'POST':
+        data = request.get_json()
+        mqt135.update(data)
+        if data:
+            return jsonify({"status": "success", "data_received": data}), 200
+        else:
+            return jsonify({"status": "error", "message": "No data received"}), 400
+    else:
+        return jsonify(mqt135)
 
 
 # Xử lý dht11
@@ -302,7 +421,6 @@
         data = request.get_json()  # lấy dữ liệu được truyền thành file json
         data_sensor_dht11.update(data)  # cập nhật dữ liệu
         if data:
-
             return jsonify({"status": "success", "data_received": data}), 200
         else:
             return jsonify({"status": "error", "message": "No data received"}), 400
@@ -337,18 +455,49 @@
     if request.method == "POST":
         data = request.json
         led_name = data.get('led_name')
-        new_status = data.get('state')
+        new_value = data.get('value')
         if led_name in led:
-            led[led_name] = new_status
-            print(led)
-            return jsonify({led_name: new_status}), 200
+            led[led_name] = new_value
+            return jsonify({led_name: new_value}), 200
         else:
             return jsonify({'error': 'Đèn không tồn tại'}), 404
     else:
         return jsonify(led)
 
 
+def get_weather_for_five_days():
+    data = requests.get(
+        'http://api.openweathermap.org/data/2.5/forecast?q=Hue&appid=07bb5510d2576951d78b0f0b637f4716&units=metric&lang=vi').json()
+    if data['cod'] != '200':
+        print('Error')
+        return
+
+    data_weather = []
+    for i in range(len(data['list'])):
+        if data['list'][i]['dt_txt'].endswith('00:00:00'):
+            temp = int(data['list'][i]['main']['temp'])
+            hum = data['list'][i]['main']['humidity']
+            icon = data['list'][i]['weather'][0]['icon']
+            icon_url = f"http://openweathermap.org/img/wn/{icon}@2x.png"
+            date = datetime.strptime(data['list'][i]['dt_txt'], '%Y-%m-%d %H:%M:%S')
+            element = {
+                "temp": int(temp),
+                'humidity': hum,
+                "icon_url": icon_url,
+                "date_of_week": date.strftime("%A")
+            }
+
+            data_weather.append(element)
+
+    return data_weather
+
+
 if __name__ == '__main__':
     with app.app_context():
         db.create_all()
+<<<<<<< HEAD
     app.run(debug=True, host='0.0.0.0')
+=======
+
+    app.run(debug=True, host='0.0.0.0')
+>>>>>>> backend
Index: static/scripts/main.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>// Xử lý cảm biến chuyển động\r\nfunction pir() {\r\n  fetch('/user_dashboard/api/motion')\r\n    .then(response => response.json())\r\n    .then(data => {\r\n      const status = (data.status ? \"Motion Detected!\" : \"No Motion\")\r\n      document.getElementById('pir').innerHTML = \"Pir HC-SR501: \" + status\r\n    })\r\n    .catch(err => {\r\n      console.error(err)\r\n    })\r\n}\r\npir()\r\nsetInterval(pir, 5000) // => cứ mỗi 5s check 1 lần\r\n\r\n\r\n// Xử lý cảm biến đo nhiệt độ và độ ẩm\r\nfunction realtime() {\r\n  fetch('/user_dashboard/api/weather')\r\n    .then(response => response.json())\r\n    .then(data => {\r\n      document.getElementById('main_weather').innerHTML = \"Trạng Thái Thời Tiết Hiện Tại: \" + data.main\r\n      document.getElementById('temperature').innerHTML = \"Nhiệt độ hiện tại: \" + data.temperature + \"℃\"\r\n      document.getElementById('humidity').innerHTML = \"Độ ẩm hiện tại: \" + data.humidity + \"%\"\r\n      document.getElementById('feels_like').innerHTML = \"Nhiệt Độ cảm nhận: \" + (data.feels_like).toFixed(2) + \"℃\"\r\n      document.getElementById('visibility').innerHTML = \"Tầm nhìn khả thi: \" + (data.visibility / 1000) + 'km'\r\n    })\r\n    .catch(err => {\r\n      console.error('Lỗi khi gửi yêu cầu: ', err);\r\n    });\r\n}\r\nrealtime()\r\nsetInterval(realtime, 5000) // => đo 1 lần mỗi 5s\r\n\r\n//Xử lý các button về đèn\r\nfunction change_status_led(name, state) {\r\n  fetch('/user_dashboard/api/change_status_led', {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({\r\n      led_name: name,\r\n      state: state\r\n    })\r\n\r\n  })\r\n    .then(response => response.json())\r\n    .then(data => {\r\n      console.log(data)\r\n    })\r\n\r\n    .catch(err => {\r\n      console.error(err)\r\n    })\r\n\r\n}\r\n\r\n// Lắng nghe sự kiện nhấn button\r\ndocument.getElementById('Led_Main_On').addEventListener(\"click\", function (event) {\r\n  change_status_led(\"Led_Main\", true)\r\n})\r\ndocument.getElementById('Led_Main_Off').addEventListener(\"click\", function (event) {\r\n  change_status_led(\"Led_Main\", false)\r\n})\r\ndocument.getElementById('Led_D7_On').addEventListener(\"click\", function (event) {\r\n  change_status_led(\"Led_D7\", true)\r\n})\r\ndocument.getElementById('Led_D7_Off').addEventListener(\"click\", function (event) {\r\n  change_status_led(\"Led_D7\", false)\r\n})\r\ndocument.getElementById('Led_D8_On').addEventListener(\"click\", function (event) {\r\n  change_status_led(\"Led_D8\", true)\r\n})\r\ndocument.getElementById('Led_D8_Off').addEventListener(\"click\", function (event) {\r\n  change_status_led(\"Led_D8\", false)\r\n})\r\n\r\n// Hiển thị giờ hiện tại\r\nfunction clock() {\r\n  let now = new Date();\r\n  let hours = now.getHours();\r\n  let minutes = now.getMinutes();\r\n  let seconds = now.getSeconds();\r\n\r\n  hours = hours < 10 ? '0' + hours : hours;\r\n  minutes = minutes < 10 ? '0' + minutes : minutes;\r\n  seconds = seconds < 10 ? '0' + seconds : seconds;\r\n\r\n  let currentTime = hours + ':' + minutes + ':' + seconds + ' - ' + now.getDate() + '/' + (now.getMonth() + 1) + '/' + now.getFullYear();\r\n\r\n  document.getElementById('clock').innerText = \"UTC+07:00 - \" + currentTime;\r\n}\r\nclock()\r\nsetInterval(clock, 1000)\r\n\r\n\r\nfunction dataPir() {\r\n  fetch('/view/history_pir')\r\n    .then(response => response.text())\r\n    .then(data => {\r\n      document.getElementById('infor').innerHTML = data\r\n    })\r\n    .catch(err => {\r\n      console.error(err)\r\n    })\r\n}\r\n\r\nif (document.getElementById('status').textContent == \"ON\") {\r\n  dataPir()\r\n  setInterval(dataPir, 10000)\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/static/scripts/main.js b/static/scripts/main.js
--- a/static/scripts/main.js	
+++ b/static/scripts/main.js	
@@ -19,11 +19,8 @@
   fetch('/user_dashboard/api/weather')
     .then(response => response.json())
     .then(data => {
-      document.getElementById('main_weather').innerHTML = "Trạng Thái Thời Tiết Hiện Tại: " + data.main
       document.getElementById('temperature').innerHTML = "Nhiệt độ hiện tại: " + data.temperature + "℃"
       document.getElementById('humidity').innerHTML = "Độ ẩm hiện tại: " + data.humidity + "%"
-      document.getElementById('feels_like').innerHTML = "Nhiệt Độ cảm nhận: " + (data.feels_like).toFixed(2) + "℃"
-      document.getElementById('visibility').innerHTML = "Tầm nhìn khả thi: " + (data.visibility / 1000) + 'km'
     })
     .catch(err => {
       console.error('Lỗi khi gửi yêu cầu: ', err);
@@ -32,22 +29,68 @@
 realtime()
 setInterval(realtime, 5000) // => đo 1 lần mỗi 5s
 
+function mqt135() {
+  fetch('/user_dashboard/api/mqt135')
+  .then(response => response.json())
+  .then(data => {
+    var value_of_mqt135 = data.value;
+
+    document.getElementById('mqt').innerHTML = "Nồng độ Co2: " + data.value + " (ppm)";
+
+    var section = document.getElementById('Section');
+
+
+    if (value_of_mqt135 <= 1000) {
+      section.innerHTML = `
+      <div class="row">
+        <div class="text">Đánh giá: </div>
+        <div class="box1">
+          <div class="emoji">🙂</div>
+          <div class="text">Good</div>
+        </div>
+      </div>`;
+    } else if (value_of_mqt135 <= 2000) {
+      section.innerHTML = `
+      <div class="row">
+        <div class="text">Đánh giá: </div>
+        <div class="box2">
+          <div class="emoji">🤒</div>
+          <div class="text">Medium</div>
+        </div>
+      </div>`;
+    } else {
+      section.innerHTML = `
+      <div class="row">
+        <div class="text">Đánh giá: </div>
+        <div class="box3">
+          <div class="emoji">😵</div>
+          <div class="text">Danger</div>
+        </div>
+      </div>`;
+    }
+
+  })
+  .catch(err => {
+    console.error(err);
+  });
+}
+mqt135();
+setInterval(mqt135, 2000);
+
+
 //Xử lý các button về đèn
-function change_status_led(name, state) {
+function change_status_led(name, data) {
   fetch('/user_dashboard/api/change_status_led', {
     method: "POST",
     headers: { "Content-Type": "application/json" },
     body: JSON.stringify({
       led_name: name,
-      state: state
+      value: data
     })
 
   })
     .then(response => response.json())
-    .then(data => {
-      console.log(data)
-    })
-
+    .then(data => {})
     .catch(err => {
       console.error(err)
     })
@@ -56,22 +99,28 @@
 
 // Lắng nghe sự kiện nhấn button
 document.getElementById('Led_Main_On').addEventListener("click", function (event) {
-  change_status_led("Led_Main", true)
+  change_status_led("Led_Main", 0)
+  document.getElementById('fade_led_Main').value = 1023
 })
 document.getElementById('Led_Main_Off').addEventListener("click", function (event) {
-  change_status_led("Led_Main", false)
+  change_status_led("Led_Main", 1023)
+  document.getElementById('fade_led_Main').value = 0
 })
 document.getElementById('Led_D7_On').addEventListener("click", function (event) {
-  change_status_led("Led_D7", true)
+  change_status_led("Led_D7", 1023)
+  document.getElementById('fade_led_D7').value = 1023
 })
 document.getElementById('Led_D7_Off').addEventListener("click", function (event) {
-  change_status_led("Led_D7", false)
+  change_status_led("Led_D7", 0)
+  document.getElementById('fade_led_D7').value = 0
 })
 document.getElementById('Led_D8_On').addEventListener("click", function (event) {
-  change_status_led("Led_D8", true)
+  change_status_led("Led_D8", 1023)
+  document.getElementById('fade_led_D8').value = 1023
 })
 document.getElementById('Led_D8_Off').addEventListener("click", function (event) {
-  change_status_led("Led_D8", false)
+  change_status_led("Led_D8", 0)
+  document.getElementById('fade_led_D8').value = 0
 })
 
 // Hiển thị giờ hiện tại
@@ -107,4 +156,77 @@
 if (document.getElementById('status').textContent == "ON") {
   dataPir()
   setInterval(dataPir, 10000)
-}
\ No newline at end of file
+}
+
+function five_days(){
+  fetch('/view/weather')
+  .then(respone => respone.text())
+  .then(data => {
+    document.getElementById('five_days_weather').innerHTML = data
+  })
+  .catch(err => {
+    console.error(err)
+  })
+}
+five_days()
+
+
+// Xử lý độ sáng cho các đèn
+
+function Light (status, data){
+  if (data == 0) document.getElementById(status).innerHTML = "Tắt Đèn!"
+  else if (data >= 1 && data <= 511) document.getElementById(status).innerHTML = "Sáng Yếu!"
+  else if (data >= 512 && data <= 1000) document.getElementById(status).innerHTML = "Sáng Vừa!"
+  else document.getElementById(status).innerHTML = "Sáng Đèn!"
+}
+
+
+// => Led Main
+document.getElementById('Option_Main').addEventListener('click', function() {
+  document.getElementById('custom_light_Main').style.display = 'flex'
+})
+
+document.getElementById('fade_led_Main').addEventListener('input', function() {
+  data = this.value
+  Light('status_main',data)
+})
+
+document.getElementById('confirm_Main').addEventListener('click', function() {
+  document.getElementById('custom_light_Main').style.display = 'none'
+  // excuted_led('Led_Main', document.getElementById('fade_led_Main').value)
+  change_status_led("Led_Main",Number(document.getElementById('fade_led_Main').value))
+})
+
+
+
+// => Led thứ nhất
+document.getElementById('Option_D7').addEventListener('click', function() {
+  document.getElementById('custom_light_D7').style.display = 'flex'
+})
+
+document.getElementById('fade_led_D7').addEventListener('input', function() {
+  data = this.value
+  Light('status_d7',data)
+})
+
+document.getElementById('confirm_D7').addEventListener('click', function() {
+  document.getElementById('custom_light_D7').style.display = 'none'
+  change_status_led("Led_D7",Number(document.getElementById('fade_led_D7').value))
+})
+
+
+
+// => Led Thứ hai
+document.getElementById('Option_D8').addEventListener('click', function() {
+  document.getElementById('custom_light_D8').style.display = 'flex'
+})
+
+document.getElementById('fade_led_D8').addEventListener('input', function() {
+  data = this.value
+  Light('status_d8',data)
+})
+
+document.getElementById('confirm_D8').addEventListener('click', function() {
+  document.getElementById('custom_light_D8').style.display = 'none'
+  change_status_led("Led_D8",Number(document.getElementById('fade_led_D8').value))
+})
\ No newline at end of file
Index: templates/signup.html
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n  <meta charset=\"UTF-8\">\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n  <title>Sign Up</title>\r\n</head>\r\n<body>\r\n  <h1>This is signup page</h1>\r\n  <form method=\"post\">\r\n    <caption>Đăng ký tài khoản người dùng</caption>\r\n    <p>Username: <input placeholder=\"Enter your username\" type=\"text\" name=\"username\"></p>\r\n    <p>Password: <input placeholder=\"Enter your password\" type=\"password\" name=\"password\"></p>\r\n    <input type=\"submit\" value=\"Signup\">\r\n  </form>\r\n  {% with messages = get_flashed_messages(with_categories=true) %}\r\n    {% if messages %}\r\n\r\n      {% for category, message in messages %}\r\n        <p class=\"category\">{{message}}</p>\r\n      {% endfor %}\r\n\r\n    {% endif %}\r\n  {% endwith %}\r\n</body>\r\n</html>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/templates/signup.html b/templates/signup.html
--- a/templates/signup.html	
+++ b/templates/signup.html	
@@ -1,26 +1,71 @@
 <!DOCTYPE html>
 <html lang="en">
+
 <head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
-  <title>Sign Up</title>
+
+  <title>Signup Site</title>
+
+  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
+    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
+  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
+    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
+    crossorigin="anonymous"></script>
+  <style>
+    body {
+      height: 100vh;
+      background: linear-gradient(to bottom, rgb(131, 131, 222), white);
+    }
+    .centered-container {
+      display: flex;
+      justify-content: center;
+      align-items: center;
+      height: 100vh;
+
+    }
+    .container{
+      max-width: 400px;
+    }
+  </style>
 </head>
+
 <body>
-  <h1>This is signup page</h1>
-  <form method="post">
-    <caption>Đăng ký tài khoản người dùng</caption>
-    <p>Username: <input placeholder="Enter your username" type="text" name="username"></p>
-    <p>Password: <input placeholder="Enter your password" type="password" name="password"></p>
-    <input type="submit" value="Signup">
-  </form>
-  {% with messages = get_flashed_messages(with_categories=true) %}
-    {% if messages %}
-
-      {% for category, message in messages %}
-        <p class="category">{{message}}</p>
-      {% endfor %}
-
-    {% endif %}
-  {% endwith %}
+  <div class="centered-container">
+    <div class="container bg-white p-5 border border-1 border-dark rounded-3">
+      <div class="row">
+        <img src="/static/images/Logo.png" alt="Logo">
+      </div>
+      <div class="row">
+        {% with messages = get_flashed_messages(with_categories=true) %}
+        {% if messages %}
+        {% for category, message in messages %}
+        <div class="alert alert-{{ category }}" role="alert">{{ message }}</div>
+        {% endfor %}
+        {% endif %}
+        {% endwith %}
+      </div>
+      <form method="post">
+        <div class="row mb-3">
+          <div class="col-sm-12">
+            <label for="username">Username</label>
+            <input class="form-control" placeholder="Enter your username" type="text" name="username">
+          </div>
+        </div>
+        <div class="row mb-3">
+          <div class="col-sm-12">
+            <label for="password">Password</label>
+            <input class="form-control" placeholder="Enter your password" type="password" name="password">
+          </div>
+        </div>
+        <div class="row">
+          <div class="col-sm-6">
+            <input class="btn btn-success" type="submit" value="Signup">
+          </div>
+        </div>
+      </form>
+    </div>
+  </div>
 </body>
-</html>
\ No newline at end of file
+
+</html>
Index: templates/userpage.html
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><!DOCTYPE html>\r\n<html lang=\"en\">\r\n\r\n<head>\r\n  <meta charset=\"UTF-8\">\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n  <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\r\n  <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin>\r\n  <link\r\n    href=\"https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap\"\r\n    rel=\"stylesheet\">\r\n  <title>Dashboard</title>\r\n  <link rel=\"stylesheet\" href=\"{{ url_for('static', filename = 'styles/style.css')}}\">\r\n  <link rel=\"icon\" href=\"{{ url_for('static', filename = 'images/module-icon.jpg')}}\">\r\n</head>\r\n\r\n<body>\r\n  <div class=\"main-left\">\r\n\r\n    <div class=\"container adiv\">\r\n\r\n      <div id=\"user\">\r\n        <div id=\"information\">\r\n          <p id=\"username\">Username: {{username}}</p>\r\n        </div>\r\n\r\n        <form method=\"post\">\r\n          <input type=\"hidden\" name=\"button\" value=\"Logout\">\r\n          <input type=\"submit\" name=\"handle\" value=\"Logout\">\r\n        </form>\r\n\r\n        <form method=\"post\">\r\n          <input type=\"hidden\" name=\"button\" value=\"Change\">\r\n          <input type=\"submit\" name=\"handle\" value=\"Change Password\">\r\n        </form>\r\n\r\n      </div>\r\n\r\n      <div class=\"tittle\">\r\n        Demo ESP8266\r\n      </div>\r\n      <div class=\"button-section\">\r\n        <div class=\"led_main\">\r\n          <div class=\"stats\">Led_Main:</div>\r\n          <div class=\"led-button\">\r\n            <button id=\"Led_Main_On\">ON</button>\r\n            <button id=\"Led_Main_Off\">OFF</button>\r\n          </div>\r\n        </div>\r\n        <div class=\"ledD0\">\r\n          <div class=\"stats\">Led_D0:</div>\r\n          <div class=\"ledD0-button\">\r\n            <button id=\"Led_D7_On\">ON</button>\r\n            <button id=\"Led_D7_Off\">OFF</button>\r\n          </div>\r\n        </div>\r\n        <div class=\"ledD1\">\r\n          <div class=\"stats\">Led_D1:</div>\r\n          <div class=\"ledD1-button\">\r\n            <button id=\"Led_D8_On\">ON</button>\r\n            <button id=\"Led_D8_Off\">OFF</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"weather-forecast adiv\">\r\n\r\n      <div class=\"Tittle\">\r\n        Thông Tin Thời Tiết\r\n      </div>\r\n\r\n      <div id=\"data\" class=\"Stats\">\r\n        <div class=\"description\">\r\n          <div id=\"main_weather\" class=\"thoi_tiet_chinh\">Loading main......</div>\r\n          <div id=\"temperature\" class=\"nhiet_do\">Loading Temperature.....</div>\r\n          <div id=\"humidity\" class=\"do_am\">Loading Humidity......</div>\r\n          <div id=\"feels_like\" class=\"cam_nhan\">Loading Temp_feels_like......</div>\r\n          <div id=\"visibility\" class=\"tam_nhin\">Loading visibility......</div>\r\n          <br>\r\n          <div id=\"clock\"></div>\r\n        </div>\r\n      </div>\r\n\r\n\r\n    </div>\r\n\r\n  </div>\r\n\r\n  <div class=\"main-right\">\r\n\r\n    <div class=\"adiv\" style=\"overflow: auto;\">\r\n\r\n      <div class=\"tittle\">Phát hiện chuyển động</div>\r\n      <h4 id=\"pir\" onclick=\"pir()\">Pir sensor HC-SR501: waiting</h4>\r\n\r\n      <div id=\"search_date_bar\">\r\n        <form method=\"post\">\r\n          <input type=\"hidden\" name=\"button\" value=\"Date\">\r\n          <input type=\"date\" name=\"startDate\" id=\"startDate\" value=\"{{start}}\">\r\n          <input type=\"date\" name=\"endDate\" id=\"endDate\" value=\"{{end}}\">\r\n          <input type=\"submit\" name=\"handle\" value=\"Search\" id=\"search\">\r\n        </form>\r\n        <form method=\"post\">\r\n          <input type=\"hidden\" name=\"button\" value=\"Overal\">\r\n          <input type=\"submit\" name=\"handle\" value=\"Overal\" id=\"overal\">\r\n        </form>\r\n      </div>\r\n      <p id=\"status\" style=\"display: none;\">{{status}}</p>\r\n      <div id=\"infor\">\r\n\r\n        <table border=\"1px\">\r\n          <thead>\r\n            <tr>\r\n              <th>ID</th>\r\n              <th>Time</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n          {%if result%}\r\n            {%for data in result%}\r\n              <tr>\r\n                <th>{{data._id}}</th>\r\n                <th>{{data.timestamp}}</th>\r\n              </tr>\r\n            {%endfor%}\r\n          {%endif%}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n\r\n    </div>\r\n\r\n  </div>\r\n\r\n</body>\r\n<script src=\"{{ url_for('static', filename = 'scripts/main.js')}}\"></script>\r\n\r\n</html>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/templates/userpage.html b/templates/userpage.html
--- a/templates/userpage.html	
+++ b/templates/userpage.html	
@@ -45,38 +45,62 @@
           <div class="led-button">
             <button id="Led_Main_On">ON</button>
             <button id="Led_Main_Off">OFF</button>
+            <button id="Option_Main">⚙</button>
           </div>
         </div>
+
+        <div id="custom_light_Main" style="display: none;">
+          <input type="range" id="fade_led_Main" min="0" max="1023">
+          <button id="confirm_Main">&#10003;</button>
+          <p id="status_main"></p>
+        </div>
+
         <div class="ledD0">
           <div class="stats">Led_D0:</div>
           <div class="ledD0-button">
             <button id="Led_D7_On">ON</button>
             <button id="Led_D7_Off">OFF</button>
+            <button id="Option_D7">⚙</button>
+
           </div>
         </div>
+
+        <div id="custom_light_D7" style="display: none;">
+          <input type="range" id="fade_led_D7" min="0" max="1023">
+          <button id="confirm_D7">&#10003;</button>
+          <p id="status_d7"></p>
+        </div>
+
         <div class="ledD1">
           <div class="stats">Led_D1:</div>
           <div class="ledD1-button">
             <button id="Led_D8_On">ON</button>
             <button id="Led_D8_Off">OFF</button>
+            <button id="Option_D8">⚙</button>
+
           </div>
         </div>
+
+        <div id="custom_light_D8" style="display: none;">
+          <input type="range" id="fade_led_D8" min="0" max="1023">
+          <button id="confirm_D8">&#10003;</button>
+          <p id="status_d8"></p>
+        </div>
+
       </div>
     </div>
     <div class="weather-forecast adiv">
 
       <div class="Tittle">
-        Thông Tin Thời Tiết
+        DHT11 và MQT135
       </div>
 
       <div id="data" class="Stats">
         <div class="description">
-          <div id="main_weather" class="thoi_tiet_chinh">Loading main......</div>
           <div id="temperature" class="nhiet_do">Loading Temperature.....</div>
           <div id="humidity" class="do_am">Loading Humidity......</div>
-          <div id="feels_like" class="cam_nhan">Loading Temp_feels_like......</div>
-          <div id="visibility" class="tam_nhin">Loading visibility......</div>
-          <br>
+          <div id="mqt" class="mqt">Loading Value.....</div>
+          <div id="Section">Loading...</div>
           <div id="clock"></div>
         </div>
       </div>
@@ -128,8 +152,12 @@
         </table>
       </div>
 
+    </div>
+    <div class="bdiv">
+      <div id="five_days_weather">
+
+      </div>
     </div>
-
   </div>
 
 </body>
Index: templates/view.html
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><!DOCTYPE html>\r\n<html lang=\"en\">\r\n\r\n<head>\r\n  <meta charset=\"UTF-8\">\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n  <title>View Database</title>\r\n  <style>\r\n    #function {\r\n      margin-top: 10px;\r\n    }\r\n    table{\r\n      border-collapse: collapse;\r\n      margin-top: 10px;\r\n    }\r\n    th,tr {\r\n      text-align: center;\r\n    }\r\n\r\n    #submit{\r\n      border: none;\r\n      background-color: white;\r\n    }\r\n  </style>\r\n</head>\r\n\r\n<body>\r\n  <h1>Danh sách người dùng</h1>\r\n  <form action=\"{{ url_for('data') }}\" method=\"get\">\r\n    <input type=\"text\" placeholder=\"Enter the infomation\" name=\"query\" value=\"{{query}}\">\r\n    <button type=\"submit\">Search</button>\r\n  </form>\r\n\r\n  {%if data%}\r\n  <table border=\"1\">\r\n    <tr>\r\n      <th>ID</th>\r\n      <th>Username</th>\r\n      <th>Password</th>\r\n\r\n    </tr>\r\n    {% for user in data %}\r\n\r\n    <tr>\r\n      <td>{{ user._id }}</td>\r\n      <td>{{ user.name }}</td>\r\n      <td>{{ user.password }}</td>\r\n\r\n    </tr>\r\n    {%endfor%}\r\n  {%else%}\r\n    <p>Không tồn tại thông tin người dùng</p>\r\n  {%endif%}\r\n\r\n  </table>\r\n  <a href=\"{{ url_for('home') }}\">Home</a>\r\n  <div id=\"function\">\r\n\r\n    <button id=\"add\">Add</button>\r\n    <button id=\"remove\">Remove</button>\r\n\r\n    <div id=\"form\"></div>\r\n\r\n  </div>\r\n\r\n  {% with messages = get_flashed_messages(with_categories=true) %}\r\n    {% if messages %}\r\n\r\n    {% for category, message in messages %}\r\n      <p class=\"category\">{{message}}</p>\r\n    {% endfor %}\r\n\r\n    {% endif %}\r\n  {% endwith %}\r\n\r\n</body>\r\n<script src=\"{{ url_for('static', filename = 'scripts/view.js')}}\"></script>\r\n\r\n</html>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/templates/view.html b/templates/view.html
--- a/templates/view.html	
+++ b/templates/view.html	
@@ -5,75 +5,283 @@
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>View Database</title>
-  <style>
-    #function {
-      margin-top: 10px;
-    }
-    table{
-      border-collapse: collapse;
-      margin-top: 10px;
-    }
-    th,tr {
-      text-align: center;
-    }
+  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
+    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
+  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
+    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
+    crossorigin="anonymous"></script>
 
-    #submit{
-      border: none;
-      background-color: white;
-    }
-  </style>
 </head>
 
-<body>
-  <h1>Danh sách người dùng</h1>
-  <form action="{{ url_for('data') }}" method="get">
-    <input type="text" placeholder="Enter the infomation" name="query" value="{{query}}">
-    <button type="submit">Search</button>
-  </form>
+<body style="height: 100vh; background:  linear-gradient(to bottom, rgb(131, 131, 222), white);">
+  <div class="container mt-3" style="margin-bottom: 10vh; max-width: 600px; ">
+    <div class="row mb-3">
+      <h1 style="text-align: center;">Danh sách tài khoản </h1>
+    </div>
+    <div class="row">
+      <form class="d-flex flex-column" action="{{ url_for('data') }}" method="get">
+        <label for="usernameLable">Tìm kiếm</label>
+        <input class="form-control mb-3 mt-3" type="text" placeholder="Enter username" name="query" value="{{query}}">
+        <button class="mx-auto btn btn-success justify-content-center" type="submit">Search</button>
+      </form>
+    </div>
+  </div>
 
-  {%if data%}
-  <table border="1">
-    <tr>
-      <th>ID</th>
-      <th>Username</th>
-      <th>Password</th>
-
-    </tr>
-    {% for user in data %}
-
-    <tr>
-      <td>{{ user._id }}</td>
-      <td>{{ user.name }}</td>
-      <td>{{ user.password }}</td>
+  <div class="container text-center">
+    <form method="post">
+      <div class="row justify-content-center">
+        <div class="col-md-8 table-container">
+          <table class="table table-hover table-bordered">
+            <thead>
+              <tr>
+                <th scope="col">ID</th>
+                <th scope="col">Username</th>
+                <th scope="col">Password</th>
+                <th scope="col">
+                </th>
+              </tr>
+            </thead>
+            <tbody>
+              {% if data %}
+              {% for user in data %}
+              <tr>
+                <th scope="row">{{ user._id }}</th>
+                <td>{{ user.name }}</td>
+                <td>
+                  <span class="showPassword">{{ user.password }}</span>
 
-    </tr>
-    {%endfor%}
-  {%else%}
-    <p>Không tồn tại thông tin người dùng</p>
-  {%endif%}
-
-  </table>
-  <a href="{{ url_for('home') }}">Home</a>
-  <div id="function">
+                  <input class="hidePassword form-control" value="{{ user.password }}" type="text" name="newPassword"
+                    style="display: none;">
+
+                  <input type="hidden" name="oldPassword" value="{{ user.password }}">
+                  <input type="hidden" name="ID" value="{{user._id}}">
+                </td>
+                <td>
+                  <input class="check" type="checkbox">
+                </td>
+              </tr>
+              {% endfor %}
+              {% else %}
+              <tr>
+                <td colspan="4" class="text-center">Không tìm thấy</td>
+              </tr>
+              {% endif %}
+            </tbody>
+          </table>
+        </div>
+      </div>
+      <input class="btn btn-success" type="submit" name="handle" value="Save">
+    </form>
+
+  </div>
+  <div class="container d-flex flex-column justify-content-center">
+    <div class="row">
+      <div class="col">
+        <div class="card mt-5">
+          <div class="card-header">
+            Tùy Chỉnh
+          </div>
+          <div class="card-body d-flex flex-wrap justify-content-center gap-3">
+            <a href="{{ url_for('home') }}" class="btn btn-outline-danger">Home</a>
+            <button id="add" class="btn btn-primary">ADD USER</button>
+            <button id="remove" class="btn btn-primary">REMOVE USER</button>
+            <button id="pending" class="btn btn-primary">PENDING USER</button>
+          </div>
+        </div>
+      </div>
+    </div>
+
+    <div class="row mt-3">
+      <div class="col">
+        <div id="formAdd" class="card" style="display: none;">
+
+          <div class="card-header">
+            Thêm Tài Khoản
+          </div>
+
+          <div class="card-body p-4">
+
+            <div class="card-title mb-3">
+              Mời bạn nhập thông tin để tiến hành thêm tài khoản
+            </div>
+
+            <div class="row p-2 ">
+              <form method="post">
+                <label for="username">Username:</label>
+                <input class="form-control mb-2 mt-2" type="text" name="username" id="username"
+                  placeholder="Enter Username">
+
+                <label for="password">Password:</label>
+                <input class="form-control mt-2 mb-4" type="text" name="password" id="password"
+                  placeholder="Enter Password">
+
+                <input class="btn btn-outline-success" type="submit" value="Add" name="handle">
+              </form>
+            </div>
+
+          </div>
+        </div>
+      </div>
+    </div>
+
+    <div class="row">
+      <div class="col">
+        <div id="formRemove" class="card" style="display: none;">
 
-    <button id="add">Add</button>
-    <button id="remove">Remove</button>
+          <div class="card-header">
+            Xóa Tài Khoản
+          </div>
 
-    <div id="form"></div>
+          <div class="card-body p-4">
+
+            <div class="card-title mb-3">
+              Mời bạn nhập thông tin để tiến hành xóa tài khoản
+            </div>
+
+            <div class="row p-2 ">
+              <form method="post">
+                <label for="username">Username:</label>
+                <input class="form-control mb-4 mt-2" type="text" name="username" id="username"
+                  placeholder="Enter Username">
+
+                <input class="btn btn-outline-success" type="submit" value="Remove" name="handle" id="check">
+
+              </form>
+            </div>
 
-  </div>
+          </div>
+        </div>
+      </div>
+    </div>
+    <div class="row">
+      <div class="col">
+        <div id="pendinguser" class="card" style="display: none;">
+
+          <div class="card-header">
+            Danh sách user đợi duyệt
+          </div>
+
+          <div class="card-body p-4">
+            <form method="post">
+              <table class="table">
+                <thead>
+                  <tr>
+                    <th scope="col">ID</th>
+                    <th scope="col">Username</th>
+                    <th scope="col">Password</th>
+                    <th scope="col">Active</th>
+                  </tr>
+                </thead>
+
+                <tbody>
+                  {%if pending%}
+                  {%for userpending in pending%}
+                  <tr>
+                    <td>
+                      {{userpending.id}}
+                    </td>
+                    <td>
+                      {{userpending.name}}
+                    </td>
+                    <td>
+                      {{userpending.password}}
+                    </td>
 
-  {% with messages = get_flashed_messages(with_categories=true) %}
-    {% if messages %}
+                    <td class="d-flex gap-4">
+                      <div class="d-flex flex-column">
+                        <label>Yes</label>
+                        <input type="checkbox" id="yes_{{userpending.id}}" name="user" value="{{ userpending.id }} True" onclick="selectOption(this, '{{ userpending.id }}')">
+                      </div>
+                      <div class="d-flex flex-column">
+                        <label>No</label>
+                        <input type="checkbox" id="no_{{userpending.id}}" name="user" value="{{ userpending.id }} False" onclick="selectOption(this, '{{ userpending.id }}')">
+                      </div>
+                    </td>
 
-    {% for category, message in messages %}
-      <p class="category">{{message}}</p>
-    {% endfor %}
-
-    {% endif %}
-  {% endwith %}
+                  </tr>
+
+                  {%endfor%}
+                  {%else%}
+                  <tr>
+                    <td colspan="3">Không có account nào pending</td>
+                  </tr>
+                  {%endif%}
+
+                </tbody>
+              </table>
+              <div class="d-flex justify-content-center">
+                <input class="btn btn-outline-success" type="submit" name="handle" value="Submit Change">
+              </div>
+            </form>
+
+
+          </div>
+        </div>
+      </div>
+    </div>
+  </div>
+
+
+  </div>
+
+  <script>
+    document.getElementById('add').addEventListener("click", function (event) {
+      document.getElementById('formAdd').style.display = 'block'
+      document.getElementById('formRemove').style.display = 'none'
+      document.getElementById('pendinguser').style.display = 'none'
+    })
+
+    document.getElementById('remove').addEventListener("click", function (event) {
+      document.getElementById('formRemove').style.display = 'block'
+      document.getElementById('formAdd').style.display = 'none'
+      document.getElementById('pendinguser').style.display = 'none'
+    })
+
+    document.getElementById('pending').addEventListener("click", function (event) {
+      document.getElementById('formRemove').style.display = 'none'
+      document.getElementById('formAdd').style.display = 'none'
+      document.getElementById('pendinguser').style.display = 'block'
+    })
+    /* vì có nhiều tk với class giống nhau
+    nên sẽ dùng querySelectorAll thay vì get ID*/
+    document.querySelectorAll('.check').forEach(checkbox => {
+      checkbox.addEventListener('change', function (event) {
+        const row = event.target.closest('tr') // => lấy ptu gần nhất chứa checkbox này
+        const show = row.querySelector('.showPassword')
+        const hide = row.querySelector('.hidePassword')
+
+
+        if (event.target.checked) {
+          show.style.display = 'none'
+          hide.style.display = 'block'
+        }
+
+        else {
+          hide.value = show.innerText;
+          show.style.display = 'block'
+          hide.style.display = 'none'
+        }
+
+      })
+    })
+
+
+    function selectOption(checkbox, index) {
+      const yesCheckbox = document.getElementById(`yes_${index}`);
+      const noCheckbox = document.getElementById(`no_${index}`);
+      // hiện ra id của user vừa mới dùng checkbox
+
+      if (checkbox === yesCheckbox) {
+        noCheckbox.checked = false;
+      } else if (checkbox === noCheckbox) {
+        yesCheckbox.checked = false;
+      }
+
+
+    }
+  </script>
 
 </body>
-<script src="{{ url_for('static', filename = 'scripts/view.js')}}"></script>
+
 
 </html>
\ No newline at end of file
Index: templates/change.html
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><!DOCTYPE html>\r\n<html lang=\"en\">\r\n\r\n<head>\r\n  <meta charset=\"UTF-8\">\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n  <title>Change pass</title>\r\n  <link rel=\"stylesheet\" href=\" {{url_for('static', filename = '/styles/change_pass.css')}} \">\r\n</head>\r\n\r\n<body>\r\n  <h4>Xin chào {{key}}</h4>\r\n  <h3>Đổi mật khẩu</h3>\r\n\r\n  <form method=\"post\">\r\n    <input placeholder=\"Your current password\" type=\"password\" name=\"oldPassword\">\r\n    <input placeholder=\"New password\" type=\"password\" name=\"newPassword\">\r\n    <input placeholder=\"Repeat new password\" type=\"password\" name=\"repeatPassword\">\r\n    <input type=\"submit\" value=\"Enter\">\r\n  </form>\r\n  {% with messages = get_flashed_messages(with_categories=true) %}\r\n    {% if messages %}\r\n\r\n      <ul>\r\n        {% for category, message in messages %}\r\n          <li class=\"category\">{{message}}</li>\r\n        {% endfor %}\r\n      </ul>\r\n\r\n    {% endif %}\r\n  {% endwith %}\r\n  <a href=\"/user_dashboard\">Back to Dashboard</a>\r\n</body>\r\n\r\n</html>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/templates/change.html b/templates/change.html
--- a/templates/change.html	
+++ b/templates/change.html	
@@ -5,31 +5,76 @@
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Change pass</title>
-  <link rel="stylesheet" href=" {{url_for('static', filename = '/styles/change_pass.css')}} ">
+  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
+    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
+  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
+    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
+    crossorigin="anonymous"></script>
+  <style>
+    body {
+      height: 100vh;
+      background: linear-gradient(to bottom, rgb(131, 131, 222), white);
+    }
+    .centered-container {
+      display: flex;
+      justify-content: center;
+      align-items: center;
+      height: 100vh;
+
+    }
+    .container{
+      max-width: 400px;
+    }
+  </style>
 </head>
 
 <body>
-  <h4>Xin chào {{key}}</h4>
-  <h3>Đổi mật khẩu</h3>
 
-  <form method="post">
-    <input placeholder="Your current password" type="password" name="oldPassword">
-    <input placeholder="New password" type="password" name="newPassword">
-    <input placeholder="Repeat new password" type="password" name="repeatPassword">
-    <input type="submit" value="Enter">
-  </form>
-  {% with messages = get_flashed_messages(with_categories=true) %}
-    {% if messages %}
-
-      <ul>
+  <div class="centered-container">
+    <div class="container bg-white p-5 border border-1 border-dark rounded-3">
+      <div class="row">
+        <img src="/static/images/Logo.png" alt="Logo">
+      </div>
+      <div class="row">
+        {% with messages = get_flashed_messages(with_categories=true) %}
+        {% if messages %}
         {% for category, message in messages %}
-          <li class="category">{{message}}</li>
+        <div class="alert alert-{{ category }}" role="alert">{{ message }}</div>
         {% endfor %}
-      </ul>
-
-    {% endif %}
-  {% endwith %}
-  <a href="/user_dashboard">Back to Dashboard</a>
+        {% endif %}
+        {% endwith %}
+      </div>
+      <div class="row">
+        <h3>Đổi mật khẩu </h3>
+      </div>
+      <form method="post">
+        <div class="row mb-3">
+          <div class="col-sm-12">
+            <label for="currentPassword">Your Current Password</label>
+            <input class="form-control" placeholder="Enter your Password" type="password" name="oldPassword">
+          </div>
+        </div>
+        <div class="row mb-3">
+          <div class="col-sm-12">
+            <label for="password">New Password</label>
+            <input class="form-control" placeholder="Enter new password" type="password" name="newPassword">
+          </div>
+        </div>
+        <div class="row mb-3">
+          <div class="col-sm-12">
+            <label for="password">Repeat New Password</label>
+            <input class="form-control" placeholder="Repeat new password" type="password" name="repeatPassword">
+          </div>
+        </div>
+        <div class="row">
+          <div class="col-sm-6 d-inline-flex gap-2">
+            <input class="btn btn-success" type="submit" value="Enter">
+            <a class="btn btn-outline-danger text-nowrap" href="/user_dashboard">Back to Dashboard</a>
+          </div>
+        </div>
+      </form>
+    </div>
+  </div>
 </body>
 
 </html>
\ No newline at end of file
Index: static/scripts/view.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/static/scripts/view.js b/static/scripts/view.js
deleted file mode 100644
--- a/static/scripts/view.js	
+++ /dev/null	
@@ -1,17 +0,0 @@
-document.getElementById('add').addEventListener("click", function (event) {
-  show_form('/add')
-})
-document.getElementById('remove').addEventListener("click", function (event) {
-  show_form('/remove')
-})
-
-function show_form(event){
-  fetch(event)
-  .then(response => response.text())
-  .then(data => {
-    document.getElementById('form').innerHTML = data
-  })
-  .catch (err => {
-    console.error(err)
-  })
-}
Index: templates/add.html
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/templates/add.html b/templates/add.html
deleted file mode 100644
--- a/templates/add.html	
+++ /dev/null	
@@ -1,6 +0,0 @@
-<form method="post">
-  <caption>Mời bạn nhập thông tin để tiến hành thêm tài khoản</caption>
-  <p>Username: <input type="text" name="username" id="username"></p>
-  <p>Password: <input type="password" name="password" id="password"></p>
-  <input type="submit" value="Add" name="handle">
-</form>
\ No newline at end of file
Index: static/styles/change_pass.css
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/static/styles/change_pass.css b/static/styles/change_pass.css
deleted file mode 100644
--- a/static/styles/change_pass.css	
+++ /dev/null	
@@ -1,11 +0,0 @@
-form{
-  display: flex;
-  flex-direction: column;
-  width: 20vh;
-}
-input{
-  margin: 2px 0;
-}
-p{
-  margin: 0;
-}
\ No newline at end of file
Index: templates/remove.html
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/templates/remove.html b/templates/remove.html
deleted file mode 100644
--- a/templates/remove.html	
+++ /dev/null	
@@ -1,5 +0,0 @@
-<form method="post">
-  <caption>Mời bạn nhập thông tin để tiến hành xóa tài khoản</caption>
-  <p>Username: <input type="text" name="username" id="username"></p>
-  <input type="submit" value="Remove" name="handle" id="check">
-</form>
\ No newline at end of file
Index: .idea/Smart-Home-Website.iml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<module type=\"PYTHON_MODULE\" version=\"4\">\r\n  <component name=\"FacetManager\">\r\n    <facet type=\"MicroPython\" name=\"MicroPython\">\r\n      <configuration>\r\n        <device name=\"ESP8266\" />\r\n      </configuration>\r\n    </facet>\r\n  </component>\r\n  <component name=\"NewModuleRootManager\">\r\n    <content url=\"file://$MODULE_DIR$\" />\r\n    <orderEntry type=\"inheritedJdk\" />\r\n    <orderEntry type=\"sourceFolder\" forTests=\"false\" />\r\n    <orderEntry type=\"library\" name=\"MicroPython\" level=\"project\" />\r\n    <orderEntry type=\"module\" module-name=\"Project-Smart-Home\" />\r\n  </component>\r\n</module>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/Smart-Home-Website.iml b/.idea/Smart-Home-Website.iml
--- a/.idea/Smart-Home-Website.iml	
+++ b/.idea/Smart-Home-Website.iml	
@@ -9,9 +9,19 @@
   </component>
   <component name="NewModuleRootManager">
     <content url="file://$MODULE_DIR$" />
+<<<<<<< HEAD
     <orderEntry type="inheritedJdk" />
     <orderEntry type="sourceFolder" forTests="false" />
     <orderEntry type="library" name="MicroPython" level="project" />
     <orderEntry type="module" module-name="Project-Smart-Home" />
+=======
+    <orderEntry type="jdk" jdkName="C:\Users\qthua\anaconda3" jdkType="Python SDK" />
+    <orderEntry type="sourceFolder" forTests="false" />
+    <orderEntry type="library" name="MicroPython" level="project" />
+  </component>
+  <component name="PyDocumentationSettings">
+    <option name="format" value="PLAIN" />
+    <option name="myDocStringFormat" value="Plain" />
+>>>>>>> backend
   </component>
 </module>
\ No newline at end of file
Index: OOP.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>from machine import Pin\r\nimport dht\r\n\r\n\r\nclass LED:\r\n    GPIO = -1\r\n    def __init__(self, pin_number):\r\n        self.led = Pin(pin_number, Pin.OUT)\r\n        self.led.value(0)\r\n        self.GPIO = pin_number\r\n\r\n    def turn_on(self):\r\n        self.led.on()\r\n\r\n    def turn_off(self):\r\n        self.led.off()\r\n\r\n    def __str__(self):\r\n        return f\"This is GPIO {self.GPIO}\"\r\n\r\n\r\nclass sensor_dht11:\r\n    def __init__(self, pin_number):\r\n        self.sensor = dht.DHT11(Pin(pin_number))\r\n        self.sensor.measure()\r\n\r\n    def get_weather(self):\r\n        return self.sensor.temperature(), self.sensor.humidity()\r\n\r\n\r\nclass motion_detect:\r\n    def __init__(self, pin_number):\r\n        self.pir = Pin(pin_number, Pin.IN)\r\n\r\n    def get_status(self):\r\n        return self.pir.value()\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/OOP.py b/OOP.py
--- a/OOP.py	
+++ b/OOP.py	
@@ -1,22 +1,35 @@
-from machine import Pin
+from machine import Pin,PWM
+from time import sleep
 import dht
 
-
 class LED:
-    GPIO = -1
     def __init__(self, pin_number):
         self.led = Pin(pin_number, Pin.OUT)
-        self.led.value(0)
-        self.GPIO = pin_number
+        self.pwm = PWM(self.led, freq=10000)
+        self.brightness = 0
+
 
-    def turn_on(self):
-        self.led.on()
+    def toggle(self, value):
 
-    def turn_off(self):
-        self.led.off()
+        if value == 0 or value == 1023:
+            self.brightness = value
+            self.pwm.duty(self.brightness)
 
-    def __str__(self):
-        return f"This is GPIO {self.GPIO}"
+        else:
+
+            if self.brightness < value:
+                for duty in range (self.brightness,value,25):
+                    self.pwm.duty(duty)
+                    sleep(0.01)
+            else:
+                for duty in range (self.brightness,value,-25):
+                    self.pwm.duty(duty)
+                    sleep(0.01)
+
+            self.brightness = value
+
+
+        return self
 
 
 class sensor_dht11:
